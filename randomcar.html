<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- favicon -->
  <link rel="icon" href="favicon.png" type="image/x-icon">

  <!-- font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libertinus+Mono&display=swap" rel="stylesheet">

  <title>Random Car</title>

  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!--navbar-->
  <header class="navbar">
    <a href="https://3deity.space" class="navbar-icon">
      <img src="navbar-icon.png" alt="Home">
    </a>

    <nav class="navbar-links">
      <a href="https://3deity.space">Home</a>
      <span class="divider">|</span>
      <a href="about">About Me</a>
      <span class="divider">|</span>
      <a href="links">My Links</a>
      <span class="divider">|</span>
      <a href="stats">Statistics</a>
      <span class="divider">|</span>
      <a href="blog">My Blog</a>
    </nav>
  </header>

  <!-- main box -->
<div class="content-box">
  <h1>Deity's Random Car Page</h1>

  <div class="button-container">
    <button id="randomCarButton">
      Random Car Model
    </button>
    <button id="openInTabButton">
      Open in Wikipedia
    </button>
  </div>
  <p></p>
  <iframe id="carFrame" width="99%" height="470"></iframe>
</div>

<script>
  let cachedCars = null;
  let currentCarTitle = ""; // keeps track of currently displayed car

  async function loadCarList() {
    if (!cachedCars) {
      try {
        const res = await fetch("/data/car_models.json"); // JSON path
        cachedCars = await res.json();

        // If using Sparse with "0:" prefixes, uncomment:
        // cachedCars = cachedCars.map(title => title.replace(/^0:/, ''));
      } catch (err) {
        alert("Failed to load car list");
        console.error(err);
      }
    }
  }

  function showRandomCar() {
    if (!cachedCars || cachedCars.length === 0) return;

    const random =
      cachedCars[Math.floor(Math.random() * cachedCars.length)];

    currentCarTitle = random.replace(/ /g, "_"); // save current car for “Open in Wikipedia”

    // Update the iframe
    const iframe = document.getElementById("carFrame");
    iframe.src = "https://en.wikipedia.org/wiki/" + currentCarTitle + "?useskin=minerva";
  }

  function openCurrentCarInNewTab() {
    if (!currentCarTitle) return; // safety check
    window.open(
      "https://en.wikipedia.org/wiki/" + currentCarTitle,
      "_blank"
    );
  }

  document.addEventListener("DOMContentLoaded", async () => {
    // Load car list once
    await loadCarList();

    // Show a random car immediately when the page loads
    showRandomCar();

    // Set up button click to show a new random car
    document
      .getElementById("randomCarButton")
      .addEventListener("click", showRandomCar);

    // Set up button click to open current car in a new tab
    document
      .getElementById("openInTabButton")
      .addEventListener("click", openCurrentCarInNewTab);
  });
</script>

</body>
</html>
