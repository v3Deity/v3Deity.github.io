<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <link rel="icon" href="favicon.png" type="image/x-icon">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libertinus+Mono&display=swap" rel="stylesheet">

  <title>Car Quiz Maker</title>
  <link rel="stylesheet" href="style.css">

  <style>
    /* inputs */
    input {
      font-family: "Libertinus Mono", monospace;
      background-color: #121214;
      color: whitesmoke;
      border: 2px solid black;
      padding: 6px;
      border-radius: 6px;
    }

    input::placeholder {
      color: #aaa;
    }

    /* search row */
    .search-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }

    /* dropdown */
    #dropdown {
      position: absolute;
      background-color: #1f1f22;
      border: 2px solid black;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      display: none;
      z-index: 10;
    }

    #dropdown div {
      padding: 4px 6px;
      cursor: pointer;
    }

    #dropdown div:hover {
      background-color: #2b2b30;
    }

    /* table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    th, td {
      border: 2px solid black;
      padding: 4px 6px;
    }

    th {
      background-color: #121214;
    }

    .button-container {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<header class="navbar">
  <a href="https://3deity.space" class="navbar-icon">
    <img src="navbar-icon.png" alt="Home">
  </a>

  <nav class="navbar-links">
    <a href="https://3deity.space">Home</a>
    <span class="divider">|</span>
    <a href="about">About Me</a>
    <span class="divider">|</span>
    <a href="links">My Links</a>
    <span class="divider">|</span>
    <a href="stats">Statistics</a>
    <span class="divider">|</span>
    <a href="blog">My Blog</a>
  </nav>
</header>

<div class="content-box">
  <h1>Deity's Car Quiz Maker</h1>
  <hr>

  <div class="button-container">
    <button id="downloadQuizButton">Download Quiz</button>
    <button id="copyQuizButton">Copy Quiz JSON</button>
    <a href="https://3deity.space/cars/quiz">
      <button>Back to Quiz</button>
    </a>
  </div>

  <hr>

  <div style="position:relative;">
    <div class="search-row">
      <input id="searchBox" placeholder="Search car brand or model...">
      <div class="button-container">
        <button id="addAllBtn">Add All</button>
        <button id="excludeAllBtn">Exclude All</button>
      </div>
    </div>
    <div id="dropdown"></div>
  </div>

  <p>
    Showing
    <input id="showCount" value="10" style="width:60px">
    /
    <span id="totalCount">0</span>
    results
  </p>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Car</th>
      </tr>
    </thead>
    <tbody id="carTable"></tbody>
  </table>
</div>

<script>
const CAR_LIST_URL = "cars.json";
const DEFAULT_SHOW = 10;

let allCars = [];
let selectedCars = [];
let showLimit = DEFAULT_SHOW;

fetch(CAR_LIST_URL)
  .then(r => r.json())
  .then(data => {
    allCars = data.sort();
    updateTable();
  });

const searchBox = document.getElementById("searchBox");
const dropdown = document.getElementById("dropdown");

searchBox.addEventListener("input", () => {
  const val = searchBox.value.toLowerCase();
  dropdown.innerHTML = "";
  if (!val) return dropdown.style.display = "none";

  const matches = allCars.filter(c => c.toLowerCase().startsWith(val));
  matches.forEach(car => {
    const div = document.createElement("div");
    div.textContent = car;
    div.onclick = () => {
      addCars([car]);
      dropdown.style.display = "none";
    };
    dropdown.appendChild(div);
  });

  dropdown.style.display = matches.length ? "block" : "none";
});

document.getElementById("addAllBtn").onclick = () => {
  const val = searchBox.value.toLowerCase();
  addCars(val ? allCars.filter(c => c.toLowerCase().startsWith(val)) : allCars);
};

document.getElementById("excludeAllBtn").onclick = () => {
  const val = searchBox.value.toLowerCase();
  selectedCars = selectedCars.filter(c => !c.toLowerCase().startsWith(val));
  updateTable();
};

function addCars(cars) {
  cars.forEach(c => {
    if (!selectedCars.includes(c)) selectedCars.push(c);
  });
  selectedCars.sort();
  updateTable();
}

function updateTable() {
  const tbody = document.getElementById("carTable");
  tbody.innerHTML = "";
  document.getElementById("totalCount").textContent = selectedCars.length;

  selectedCars.slice(0, showLimit).forEach((car, i) => {
    const row = tbody.insertRow();
    row.insertCell().textContent = i + 1;
    row.insertCell().textContent = car;
  });
}

document.getElementById("showCount").addEventListener("keydown", e => {
  if (e.key === "Enter") {
    const n = parseInt(e.target.value);
    showLimit = isNaN(n) || n <= 0 ? DEFAULT_SHOW : n;
    e.target.value = showLimit;
    updateTable();
  }
});

function exportJSON() {
  return JSON.stringify(selectedCars, null, 2);
}

document.getElementById("copyQuizButton").onclick = () =>
  navigator.clipboard.writeText(exportJSON());

document.getElementById("downloadQuizButton").onclick = () => {
  const blob = new Blob([exportJSON()], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "car_quiz.json";
  a.click();
};
</script>

</body>
</html>
